# David - 2019-10-21

## Installation
This app was built with node v10.16.3 and npm 6.9.0. To install and run the application:
```sh
git clone <repo>
cd <repo>
npm install
npm start
```
Open [https://localhost:3000](https://localhost:3000) to view it in the browser.
You will likely need to accept the certificate warning as https is being served without a valid certificate.

## Security
### Addressed Concerns
#### Server
* Overwriting files outside of the uploads directory. The filename used to save to disk is generated by the server.
* Deleting files outside of the uploads directory. Files are verified against an in-memory list to ensure the filename exists and is expected.

##### Client
* XSS attacks: The filename is rendered via React so it is escaped. There are no dynamic links to inject JavaScript.
* Mitm attacks: Partially addressed with https; HSTS should be added.

### Unaddressed Concerns
#### Server
* DOS attacks: There is no rate-limiting on uploads, and uploads are never deleted. The memory used to store filenames can also grow infinitely.

#### Client
* Website spoofing: Users could easily be tricked to upload to another similar looking website.

## Improvements
### Client
* Use a UI framework or component library
* Add padding around the main application
* More responsive font-sizes and component sizes (vw or vh)
* Display errors via toast-messages or other UI pattern. Clearing the error state immediately after `window.open` is hacky
* Better error handling - error codes exist client-side, and the server coudl use these as well to syync up server and client error messages
* Ensure 500-type errors where we have no knowledge about what went wrong are handled, perhaps with a default error message
* Better error logging
* Debounce search to improve performance
* Pagination or infinite scroll
* Animate out deleted Documents so it is clear which one is being deleted. Possibly add a confirmation step
* Ability to view uploads - in the browser, thumbnails, via a download link (also server)
* Ability to name/tag Documents beyond the original filename (also server)
* Stylisting consistency - arrow vs function

### Server
* Better error logging and handling. Better error codes and messages.
* Check that the universal error handler works in all cases and ensure it doesn't leak stack traces/implementation details.
* Use a database or some sort of shared storage so that the server can be multi-process
* Additional checks on allowed filetypes, possibily by attemtping to read in the file although of course this could be dangerous.

## Libraries
* create-react-app: Ease of setup w/ webpack, and includes tools like eslint, babel, jest, express...
* multer: server-side multipart form-data support to save the files on the server
* react-test-renderer: for generating snapshots for jest tests

## API
### General Observations
The API lacks any way to view the uploaded documents. The fact that they are images means we might want to support thumbnail views as well. The API also lacks any sort of pagination support, so it might be providing more data than is really usable once a lot of documents are uploaded.

### GET /api/files
* Lists files uploaded to the server
* Format: `[{ filename, filekey, size }]` where filename is the original filename, filekey is a unique identifier (and also the filename on the server), and size is the size in bytes
* Parameters: `q` query parameter. When included, only records whose filename includes the query parameter are returned

### POST /api/files
* Uploads a single file
* Return format `{ filename, filekey, size }` of the uploaded file, or a `{ msg: errorMessge}` for failures
* Parameters: a `multipart/form-data` body, the name needs to be "file" in the `Content-Disposition`

### DELETE /api/files/:filekey
* Deletes a single file
* Return format `{ filekey }` of the deleted file or `{ msg: 'Delete failed' }` if there was an error
* Parameters: The `filekey` of the file to delete as a route parameter
